<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>paper-pagination test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/wct-mocha/wct-mocha.js"></script>

    <script type="module" src="../paper-pagination.js"></script>
  </head>
  <body>

    <test-fixture id="DefaultTestFixture">
      <template>
        <paper-pagination></paper-pagination>
      </template>
    </test-fixture>

    <test-fixture id="CustomTestFixture1">
      <template>
        <paper-pagination total-items="10" item-per-page="5" view-page-range="10" next-icon="paper-pagination:next-arrow" previous-icon="paper-pagination:previous-arrow" position="left"></paper-pagination>
      </template>
    </test-fixture>

    <test-fixture id="CustomTestFixture2">
      <template>
        <paper-pagination total-items="100" item-per-page="10" view-page-range="5" next-icon="paper-pagination:next-arrow" previous-icon="paper-pagination:previous-arrow" position="center"></paper-pagination>
      </template>
    </test-fixture>

    <test-fixture id="CustomTestFixture3">
        <template>
          <paper-pagination total-items="30" item-per-page="12" view-page-range="5" next-icon="paper-pagination:next-arrow" previous-icon="paper-pagination:previous-arrow" position="center"></paper-pagination>
        </template>
      </test-fixture>

    <script type="module">
      suite('paper-pagination', () => {

        test('instantiating the element with default properties', (done) => {
          const element = fixture("DefaultTestFixture");
          assert.equal(element.position, 'right','On position property');
          assert.equal(element.viewPageRange, 5,'On viewPageRange property');
          assert.equal(element.page, 1,'On page property');
          assert.equal(element.totalItems, undefined, 'On totalItems property');
          assert.equal(element.itemPerPage, undefined, 'On itemPerPage property');
          assert.equal(element.numberPages, undefined, 'On numberPages property');
          assert.deepEqual(element.listNumberPerPage, [5, 10, 20, 30, 40, 50], 'On listNumberPerPage property');
          assert.equal(element.nextIcon, undefined, 'On nextIcon property');
          assert.equal(element.previousIcon, undefined, 'On previousIcon property');
          done();
        });

        test('instantiating the element with custom properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");
          assert.equal(element.position, 'left','On position property');
          assert.equal(element.viewPageRange, 10,'On viewPageRange property');
          assert.equal(element.page, 1,'On page property');
          assert.equal(element.totalItems, 10, 'On totalItems property');
          assert.equal(element.itemPerPage, 5, 'On itemPerPage property');
          assert.equal(element.numberPages, 2, 'On numberPages property');
          assert.deepEqual(element.listNumberPerPage, [5, 10, 20, 30, 40, 50], 'On listNumberPerPage property');
          assert.equal(element.nextIcon, "paper-pagination:next-arrow", 'On nextIcon property');
          assert.equal(element.previousIcon, "paper-pagination:previous-arrow", 'On previousIcon property');
          let generatedPageButtons = element.shadowRoot.querySelectorAll("paper-button");
          if(element.viewPageRange < element.numberPages){
            assert.equal(generatedPageButtons.length, element.viewPageRange, 'On generatedPageButtons');
          } else {
            assert.equal(generatedPageButtons.length, element.numberPages, 'On generatedPageButtons');
          }
          done();
        });  

        test('instantiating the element with custom properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");
          assert.equal(element.position, 'center','On position property');
          assert.equal(element.viewPageRange, 5,'On viewPageRange property');
          assert.equal(element.page, 1,'On page property');
          assert.equal(element.totalItems, 100, 'On totalItems property');
          assert.equal(element.itemPerPage, 10, 'On itemPerPage property');
          assert.equal(element.numberPages, 10, 'On numberPages property');
          assert.deepEqual(element.listNumberPerPage, [5, 10, 20, 30, 40, 50], 'On listNumberPerPage property');
          assert.equal(element.nextIcon, "paper-pagination:next-arrow", 'On nextIcon property');
          assert.equal(element.previousIcon, "paper-pagination:previous-arrow", 'On previousIcon property');
          let generatedPageButtons = element.shadowRoot.querySelectorAll("paper-button");
          if(element.viewPageRange < element.numberPages){
            assert.equal(generatedPageButtons.length, element.viewPageRange, 'On generatedPageButtons');
          } else {
            assert.equal(generatedPageButtons.length, element.numberPages, 'On generatedPageButtons');
          }
          done();
        });

        test('instantiating the element with custom properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");
          assert.equal(element.position, 'center','On position property');
          assert.equal(element.viewPageRange, 5,'On viewPageRange property');
          assert.equal(element.page, 1,'On page property');
          assert.equal(element.totalItems, 30, 'On totalItems property');
          assert.equal(element.itemPerPage, 12, 'On itemPerPage property');
          assert.equal(element.numberPages, 3, 'On numberPages property');
          assert.deepEqual(element.listNumberPerPage, [5, 10, 12, 20, 30, 40, 50], 'On listNumberPerPage property');
          assert.equal(element.nextIcon, "paper-pagination:next-arrow", 'On nextIcon property');
          assert.equal(element.previousIcon, "paper-pagination:previous-arrow", 'On previousIcon property');
          let generatedPageButtons = element.shadowRoot.querySelectorAll("paper-button");
          if(element.viewPageRange < element.numberPages){
            assert.equal(generatedPageButtons.length, element.viewPageRange, 'On generatedPageButtons');
          } else {
            assert.equal(generatedPageButtons.length, element.numberPages, 'On generatedPageButtons');
          }
          done();
        });

        var testGeneratedList = (element, container, generatedPageButtons, selectedPage, actionType) => {
          //checking for the scroll action
          assert.deepEqual(element.page, selectedPage, 'On page property with '+ actionType);
          let middlePageButtonIndex = Math.floor(element.viewPageRange/2);
          let firstPageButton;
          let lastPageButtonCounter = element.viewPageRange - middlePageButtonIndex;
          if(element.numberPages > element.viewPageRange +1 && element.page > middlePageButtonIndex){
              if(element.page + element.viewPageRange <= element.numberPages + lastPageButtonCounter){
                  firstPageButton = element.page - middlePageButtonIndex;
              } else {
                  firstPageButton = element.numberPages - element.viewPageRange +1;
              }                
          } else {
              firstPageButton = 1;
          }
          var i = 0;
          for (let count = firstPageButton; count < firstPageButton + element.viewPageRange && count <= element.numberPages;  count++) {
              assert.equal(generatedPageButtons[i].page, count, 'On generated page list');
              i++;
          }
        };

        var testGeneratedListWithClick = (index, element) => {
          let container = element.shadowRoot.getElementById("container");
          let generatedPageButtons = container.getElementsByTagName("paper-button");
          var selectedPage = generatedPageButtons[index].page;
          generatedPageButtons[index].click();
          testGeneratedList(element, container, generatedPageButtons, selectedPage, "Click");
        };

        test('Testing page selection with click on properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");
          for(var i = 0; i < element.viewPageRange && i < element.numberPages; i++){
            testGeneratedListWithClick(i, element);
          }
          done();
        });

        test('Testing page selection with click on properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");
          for(var i = 0; i < element.viewPageRange && i < element.numberPages; i++){
            testGeneratedListWithClick(i, element);
          }
          done();
        });

        test('Testing page selection with click on properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");
          for(var i = 0; i < element.viewPageRange && i < element.numberPages; i++){
            testGeneratedListWithClick(i, element);
          }
          done();
        });

        var testGeneratedListWithSendInput = (index, element) => {
          let container = element.shadowRoot.getElementById("container");
          let generatedPageButtons = container.getElementsByTagName("paper-button");
          let pageInput = container.getElementsByTagName("paper-input");
          pageInput[0].value = index;
          element.sendInput({keyCode: 13});
          if(index <= element.numberPages && index >= 1 ){
            testGeneratedList(element, container, generatedPageButtons, index, "Send Input");
          } else {
            assert.notEqual(element.page, index, 'On page property with selected page > element.numberPages');
            assert.equal(pageInput[0].value, undefined,'On pageInput.value with selected page > element.numberPages');
            assert.equal(pageInput[0].placeholder, element.page, 'On pageInput.placeholder with selected page > element.numberPages');
          }
        };

        test('Testing page selection with sendInput on properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");          
          for(var i = -1; i < element.numberPages+1; i++){
            testGeneratedListWithSendInput(i, element);
          }
          done();
        });

        test('Testing page selection with sendInput on properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");         
          for(var i = -1; i < element.numberPages+1; i++){
            testGeneratedListWithSendInput(i, element);
          }
          done();
        });

        test('Testing page selection with sendInput on properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");          
          for(var i = -1; i < element.numberPages+1; i++){
            testGeneratedListWithSendInput(i, element);
          }
          done();
        });

        var testGeneratedListOnChangeItemsPerPage = (index, element) => {
          let container = element.shadowRoot.getElementById("container");
          let generatedPageButtons = container.getElementsByTagName("paper-button");
          element.itemPerPage = element.listNumberPerPage[index];
          testGeneratedList(element, container, generatedPageButtons, element.page, "Change Items Per Page");
        };
        
        test('Testing change-item-per-page on properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");
          for(var i = 0; i < element.listNumberPerPage.length; i++){
            testGeneratedListOnChangeItemsPerPage(i, element);
          }
          done();
        });

        test('Testing change-item-per-page on properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");
          for(var i = 0; i < element.listNumberPerPage.length; i++){
            testGeneratedListOnChangeItemsPerPage(i, element);
          }
          done();
        });

        test('Testing change-item-per-page on properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");
          for(var i = 0; i < element.listNumberPerPage.length; i++){
            testGeneratedListOnChangeItemsPerPage(i, element);
          }
          done();
        });

        var testGeneratedListOnbuttonClick = (index, element, buttonIndex) => {
          let container = element.shadowRoot.getElementById("container");
          let generatedPageButtons = container.getElementsByTagName("paper-button");
          let button = container.getElementsByTagName("paper-icon-button")[buttonIndex];
          var selectedPage;
          var buttonType;
          switch(buttonIndex){
            case 0:
              buttonType = "Prevoius Button Click";
              selectedPage = element.page-1;
              break;
            case 1:
              buttonType = "Next Button Click";
              selectedPage = element.page+1;
              break;
          };
          button.click();
          switch(true){
            case buttonIndex === 0 && selectedPage < 1:
              element.clickPreviousPage();
              assert.equal(element.page, selectedPage+1);
              assert.equal(button.disabled, true);
              break;
            case buttonIndex === 1 && selectedPage > element.numberPages:
              element.clickNextPage();
              assert.equal(element.page, selectedPage-1);
              assert.equal(button.disabled, true);
              break;
            default:
              testGeneratedList(element, container, generatedPageButtons, selectedPage, buttonType);
              break; 
          }
        };

        test('Testing next button clicks on properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 1);
          };
          done();
        });

        test('Testing next button clicks on properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 1);
          };
          done();
        });

        test('Testing next button clicks on properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 1);
          };
          done();
        });

        test('Testing previuos button clicks on properties-set1', (done) => {
          const element = fixture("CustomTestFixture1");
          element.page = element.numberPages;
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 0);
          };
          done();
        });

        test('Testing previuos button clicks on properties-set2', (done) => {
          const element = fixture("CustomTestFixture2");
          element.page = element.numberPages;
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 0);
          };
          done();
        });

        test('Testing previuos button clicks on properties-set3', (done) => {
          const element = fixture("CustomTestFixture3");
          element.page = element.numberPages;
          for(var i = 0; i <= element.numberPages; i++){
            testGeneratedListOnbuttonClick(i, element, 0);
          };
          done();
        });

      });
    </script>
  </body>
</html>
